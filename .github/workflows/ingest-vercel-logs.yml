name: Ingest Vercel Runtime Logs

on:
  schedule:
    # Every 10 minutes
    - cron: "*/10 * * * *"
  workflow_dispatch: # Allow manual trigger

jobs:
  ingest:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Vercel log ingest endpoint
        env:
          LOG_API_SECRET: ${{ secrets.LOG_API_SECRET }}
          BASE_URL: https://www.meantforgreatness.org
        run: |
          RESULT=$(curl -sf -H "Authorization: Bearer $LOG_API_SECRET" \
            "$BASE_URL/api/cron/ingest-vercel-logs" 2>/dev/null || echo "")

          if [ -z "$RESULT" ]; then
            echo "Could not reach ingest endpoint."
            exit 0
          fi

          echo "$RESULT" | jq . 2>/dev/null || echo "$RESULT"
